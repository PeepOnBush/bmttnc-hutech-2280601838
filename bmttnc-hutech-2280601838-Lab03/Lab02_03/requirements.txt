# Tạo file "__init__.py" trong folder "ecc".

# ecc/__init__.py
from ecc.ecc_cipher import ECCCipher

from flask import Flask, request, jsonify
from cipher.rsa import RSACipher

# Thêm đoạn này ngay trước hàm main
ECC_CIPHER_ALGORITHM = ECCCipher()
ecc_cipher = ECCCipher()

# app.route('/api/ecc/generate-keys', methods=['GET'])
def ecc_generate_keys():
    ecc_cipher.generate_keys()
    return jsonify({'message': 'Keys generated successfully'})

# app.route('/api/ecc/sign', methods=['POST'])
def ecc_sign_message():
    data = request.json
    message = data['message']
    private_key = ecc_cipher.load_keys()
    signature = ecc_cipher.sign(message, private_key)
    signature_hex = signature.hex()
    return jsonify({'signature': signature_hex})

# app.route('/api/ecc/verify', methods=['POST'])
def ecc_verify():
    data = request.json
    message = data['message']
    signature_hex = data['signature']
    public_key = ecc_cipher.load_keys()
    signature = bytes.fromhex(signature_hex)
    is_verified = ecc_cipher.verify(message, signature, public_key)
    return jsonify({'is_verified': is_verified})

# Khởi động lại development server. Nếu development server đang chạy, nhấn tổ hợp phím Ctrl + C để ngắt.